corrector:
  groupby:
    patient:
      by: [study_no]

features:

  # ---------------------------
  # Utils
  # ---------------------------
  # .. note: It will be applied to the tidy structure because
  #          date is a column of the DataFrame. However, it
  #          will not be applied to the stack structure because
  #          date is not within the 'columns' column values.
  - name: date
    ctype: utils
    #transformations:
    #  - dtype_correction: {dtype: datetime64}
    #  - date_outliers_correction:
    #      groupby: patient
    #      max_days_to_median: 25
    #      outliers_as_nat: True

  - name: day_from_admission
    ctype: utils
    description: Day count from patient's admission (computed from event_admission)

  - name: day_from_enrolment
    ctype: utils
    description: Day count from patient's enrolment (computed from event_enrolment)

  - name: day_from_onset
    ctype: utils
    warning: There should not be any negative value!
    description: Day count from patient's onset (compute from event_onset)

  - name: dsource
    ctype: utils
    description: It describes the data source (e.g. study 06dx).

  - name: study_no
    ctype: utils
    description: Patient ID number during the study.


  # ---------------------------
  # Demographics
  # ---------------------------
  - name: age
    ctype: demographics
    unit: year
    range:
      absolute: [0, 120, year]
    transformations:
      - dtype_correction: {dtype: Float64}
      - range_correction: {range: [0, 120]}
      - fillna_correction: {method: fbfill, groupby: patient}

  - name: gender
    ctype: demographics
    categories:
      - Male
      - Female
    transformations:
      - static_correction: {method: mode, groupby: patient}

  - name: weight
    ctype: demographics
    unit: kg
    range:
      absolute: [0.5, 120, kg]
    transformations:
      - dtype_correction: {dtype: Float64, errors: coerce}
      - range_correction: {range: [0.5, 120]}
      - fillna_correction: {method: fbfill, groupby: patient}

  - name: height
    ctype: demographics
    unit: cm
    range:
      absolute: [50, 200, cm]
    transformations:
      - dtype_correction: {dtype: Float64, errors: coerce}
      - range_correction: {range: [20, 200]}
      - fillna_correction: {method: fbfill, groupby: patient}

  # --------------------
  # Comorbidities
  # --------------------
  - name: aids
    ctype: comorbidities
    description: The human immunodeficiency viruses (HIV) are two species of Lentivirus
                 (a subgroup of retrovirus) that infect humans. Over time, they cause
                 acquired immunodeficiency syndrome (AIDS),[1][2] a condition in which
                 progressive failure of the immune system allows life-threatening opportunistic
                 infections and cancers to thrive.

  - name: anorexia
    ctype: comorbidities
    transformations:
      - static_correction: {method: max, groupby: patient}
      - fillna_correction: {value: False}

  - name: pregnant
    ctype: comorbidities
    transformations:
      - static_correction: {method: max, groupby: patient}
      - fillna_correction: {value: False}

  - name: diabetes
    ctype: comorbidities
    transformations:
      - static_correction: {method: max, groupby: patient}
      - fillna_correction: {value: False}

  - name: asthma
    ctype: comorbidities
    transformations:
      - static_correction: {method: max, groupby: patient}
      - fillna_correction: {value: False}

  - name: anemia
    ctype: comorbidities
    transformations:
      - static_correction: {method: max, groupby: patient}
      - fillna_correction: {value: False}

  - name: peptic_ulcer
    ctype: comorbidities
    transformations:
      - static_correction: {method: max, groupby: patient}
      - fillna_correction: {value: False}

  - name: chronic_hepatitis
    ctype: comorbidities
    transformations:
      - static_correction: {method: max, groupby: patient}
      - fillna_correction: {value: False}

  - name: chronic_pulmo
    ctype: comorbidities

  - name: coronary_heart_disease
    ctype: comorbidities

  - name: hypertension
    ctype: comorbidities

  # ---------------
  # Vital signs
  # ---------------
  - name: body_temperature
    unit: celsius
    ctype: vital sign
    range:
      absolute: [35, 43, celsius]
      reference: [36, 37.5, celsius]
      hypotermia: [10, 35, celsius]
    transformations:
      - dtype_correction: {dtype: Float64}
      - order_magnitude_correction:
          range: [35, 43]
          orders: [10, 100]
      - range_correction:
          range: [10, 45]

  - name: respiratory_rate
    unit: breath/minute
    ctype: vital sign
    range:
      absolute: [10, 60, breath/minute]  # at rest
      reference: [12, 25, breath/minute] # at rest
    transformations:
      - dtype_correction: {dtype: Float64}
      - range_correction:
          range: [5, 200]

  - name: pulse
    unit: beat/minute
    ctype: vital sign
    range:
      absolute: [50, 200, beat/minute]
      reference: [60, 100, beat/minute] # at rest
    transformations:
      - dtype_correction: {dtype: Float64}
      - range_correction:
          range: [50, 200]

  - name: pulse_pressure
    unit: mmHg
    ctype: vital sign
    transformations:
      - dtype_correction: {dtype: Float64, errors: coerce} # Issue

  - name: dbp
    unit: mmHg
    ctype: vital sign
    range:
      absolute: [40, 100, mmHg]
      reference: [60, 80, mmHg]
    transformations:
      - dtype_correction: {dtype: Float64}
      - range_correction:
          range: [10, 100]

  - name: sbp
    unit: mmHg
    ctype: vital sign
    range:
      absolute: [50, 200, mmHg]
      reference: [90, 120, mmHg]
    transformations:
      - dtype_correction: {dtype: Float64}  # Issue
      - range_correction:
          range: [10, 200]

  - name: spo2_percent
    unit: percent
    ctype: vital sign
    range:
      normal: [95, 100, percent]
    transformations:
      - dtype_correction: {dtype: Float64}
      - range_correction:
          range: [0, 100]
    description: Oxygen saturation is the fraction of oxygen-saturated hemoglobin relative to total
                 hemoglobin in the blood. The human body requires and regulates a very precise and
                 specific balance of oxygen in the blood. Normal arterial blood oxygen saturation
                 levels in humans are 95â€“100 percent.

  # ----------------------
  # Examination - Bleeding
  # ----------------------
  - name: bleeding_severe
    ctype: examination
    warning: There are values 1, 2, False, True. In addition, the definition of bleeding severity
             has changed considerably along the studies. It would be wiser to define the severity
             based on the bleeding subcategories. Could also be merge with bleeding_severity?

  - name: bleeding
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}
    warning: Double check all datasets have bleeding.
    description: Compound feature from bleeding subcategories, thus, it is True if any of
                 the bleeding subcategories is True. The bleeding subcategories are skin,
                 mucosal, nose, gum, urine, vaginal, vensite and gi.

  - name: bleeding_gi
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}
      - fillna_correction: {method: fbfill, groupby: patient}

  - name: bleeding_gum
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}
      - fillna_correction: {method: fbfill, groupby: patient}

  - name: bleeding_mucosal
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}
      - fillna_correction: {method: fbfill, groupby: patient}

  - name: bleeding_mucosal_level
    ctype: examination
    transformations:
      - dtype_correction: {dtype: Float64}

  - name: bleeding_nose
    ctype: examination
    description: Technical names might include Epistaxis.
    transformations:
      - dtype_correction: {dtype: boolean}
      - fillna_correction: {method: fbfill, groupby: patient}

  - name: bleeding_skin
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}
      - fillna_correction: {method: fbfill, groupby: patient}

  - name: bleeding_urine
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}
      - fillna_correction: {method: fbfill, groupby: patient}

  - name: bleeding_vaginal
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}
      - fillna_correction: {method: fbfill, groupby: patient}

  - name: bleeding_vensite
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}
      - fillna_correction: {method: fbfill, groupby: patient}

  - name: bleeding_other
    ctype: examination
    warning: It is a mix of boolean and string. It could be renamed as bleeding_description
             but has information that it is already incorporated in other variables such as
             haeatoma? It is in vietnamese.
    #transformations:
    #  - dtype_correction: {dtype: boolean}

  - name: bleeding_other_description
    warning: Rename as bleeding_description. It is in vietnamese.

  - name: epistaxis
    ctype: examination
    warning: Could it be merged with bleeding_nose?
    description: Bleeding from the nose, caused by damage to the blood vessels of
                 the nasal mucosa.

  - name: packing_gum
    ctype: examination
    warning: Could it be merged with bleeding_gum?

  - name: packing_nose
    ctype: examination
    warning: Could it be merged with bleeding_nose?
    transformations:
      - dtype_correction: {dtype: boolean}

  - name: hematemesis
    warning: Could it be merged with vomiting? Does vomiting means vomiting blood?
    description: Hematemesis is the vomiting of blood. The source is generally the upper gastrointestinal
                 tract, typically above the suspensory muscle of duodenum. Patients can easily confuse it
                 with hemoptysis (coughing up blood), although the latter is more common. Hematemesis "is
                 always an important sign".

  - name: hematuria
    warning: Could it be merged with bleeding_urine?
    description: Hematuria is the presence of blood in a person's urine.

  - name: hematoma
    ctype: examination
    description: A hematoma, also spelled haematoma, or blood suffusion is a localized bleeding
                 outside of blood vessels, due to either disease or trauma including injury or
                 surgery and may involve blood continuing to seep from broken capillaries.

  - name: haemorrhage
    ctype: examination
    description: An escape of blood from a ruptured blood vessel.

  - name: melaena
    description: The production of dark sticky faeces containing partly digested blood, as a
                 result of internal bleeding or the swallowing of blood.

  # -----------------------
  # Examination - abdominal
  # -----------------------
  - name: abdominal_pain
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}
      - fillna_correction: {method: fbfill, groupby: patient}

  - name: abdominal_pain_level
    ctype: examination
    transformation:
      - dtype_correction: {dtype: Float64}

  - name: abdominal_tenderness
    ctype: examination

  - name: abdominal_distension
    ctype: examination

  - name: ascites
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}
      - fillna_correction: {method: fbfill, groupby: patient}
    description: Ascites is the abnormal buildup of fluid in the abdomen. Technically,
                 it is more than 25 ml of fluid in the peritoneal cavity, although volumes
                 greater than one liter may occur. Symptoms may include increased abdominal
                 size, increased weight, abdominal discomfort, and shortness of breath.

  - name: ascites_level
    ctype: examination
    transformations:
      - dtype_correction: {dtype: Float64}
    warning: Appears only in 06dx and has only None or 1. Therefore, it could
             interpreted as the presence of ascites (boolean).

  # ------------------
  # Examination - Skin
  # ------------------
  - name: skin_clammy
    transformations:
      - dtype_correction: {dtype: boolean}

  - name: skin_flush
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}
      - fillna_correction: {method: fbfill, groupby: patient}

  - name: skin_rash
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}
      - fillna_correction: {method: fbfill, groupby: patient}

  - name: abscess
    ctype: examination
    warning: Can it be merged with some sort of skin feature?
    description: An abscess is a collection of pus that has built up within the tissue
                 of the body (usually skin). Signs and symptoms of abscesses include
                 redness, pain, warmth, and swelling. The swelling may feel fluid-filled
                 when pressed. The area of redness often extends beyond the swelling.

  - name: cyanosis
    ctype: examination
    warning: Can it be merged with some sort of skin feature?
    description: Cyanosis refers to a bluish cast to the skin and mucous membranes. Peripheral
                 cyanosis is when there is a bluish discoloration to your hands or feet. It's
                 usually caused by low oxygen levels in the red blood cells or problems getting
                 oxygenated blood to your body.

  - name: jaundice
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}
      - fillna_correction: {method: fbfill, groupby: patient}
    description: Jaundice is when your skin and the whites of your eyes turn yellow.
                 It can be a sign of something serious, such as liver disease.

  - name: petechiae
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}
      - fillna_correction: {method: fbfill, groupby: patient}
    description: Petechiae are tiny purple, red, or brown spots on the skin. They
                 usually appear on your arms, legs, stomach, and buttocks. You might
                 also find them inside your mouth or on your eyelids.

  - name: petechiae_level
    ctype: examination

  - name: bruising
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}
      - fillna_correction: {method: fbfill, groupby: patient}
    warning: Could it be merged with hematoma or viceversa?
    description: A bruise, or contusion, appears on the skin due to trauma. Examples of
                 trauma are a cut or a blow to an area of the body. The injury causes tiny
                 blood vessels called capillaries to burst. Blood gets trapped below the
                 skin's surface, which causes a bruise.

  - name: bruising_level
    ctype: examination
    transformations:
      - dtype_correction: {dtype: Float64}

  - name: ecchymosis
    ctype: examination
    warning: Could it be merged with bruising?
    description: A discoloration of the skin resulting from bleeding underneath,
                 typically caused by bruising.

  # ----------------
  # Lungs
  # ----------------
  - name: pleural_effusion
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}
      - fillna_correction: {method: fbfill, groupby: patient}
    description: Pleural effusion, sometimes referred to as "water on the lungs",
                 is the build-up of excess fluid between the layers of the pleura
                 outside the lungs.

  - name: pleural_effusion_left
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}
    description: Pleural effusion located on the left lung.

  - name: pleural_effusion_right
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}
    description: Pleural effusion located on the right lung.

  - name: rales_crackles
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}
    warning: Can it be merge or used with chest_sound_left and chest_sound_right?
    description: Crackles are also known as alveolar rales and are the sounds heard in a
                 lung field that has fluid in the small airways. The sound crackles create
                 are fine, short, high-pitched, intermittently crackling sounds. The cause
                 of crackles can be from air passing through fluid, pus or mucus

  - name: respiratory_distress
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}
      - fillna_correction: {method: fbfill, groupby: patient}
    warning: Can this feature be computed from respiratory_rate? If so, respiratory_distress
             would pass from appearing in 6 datasets to appear in 9. The respiratory rate
             appears in 7.

  - name: chest_indrawing
  - name: chest_sound_left
  - name: chest_sound_right

  # -------------------
  # Examination - Other
  # -------------------
  - name: diarrhoea
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}
      - fillna_correction: {method: fbfill, groupby: patient}

  - name: diarrhoea_level
    ctype: examination
    transformations:
      - dtype_correction: {dtype: Float64}

  - name: vomiting
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}
      - fillna_correction: {method: fbfill, groupby: patient}

  - name: vomiting_level
    ctype: examination
    transformations:
      - dtype_correction: {dtype: Float64}

  - name: oedema
    ctype: examination
    warning: Compound feature from oedema subcategories, thus, it is True if any of
             the oedema subcategories is True. The oedema subcategories are face,
             feet, hands and pulmonary. In many datasets oedema is specified; not sure
             whether it represents oedema in general (without subcategory) or it is more
             likely to refer to a pulmonary oedema.

  - name: oedema_pulmonary
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}
      - fillna_correction: {method: fbfill, groupby: patient}

  - name: rhinitis
    warning: Could it be merged with runny_nose?
    description: Rhinitis is inflammation and swelling of the mucous membrane of the nose,
                 characterized by a runny nose and stuffiness and usually caused by the common
                 cold or a seasonal allergy. Colds and allergies are the most common causes of
                 rhinitis. Symptoms of rhinitis include a runny nose, sneezing, and stuffines

  - name: runny_nose

  - name: pulse_status
    ctype: examination
    categories:
      - Strong
      - Weak
      - Not done / Not detected
      - Unknown

  - name: cough
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}

  - name: chills
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}

  - name: headache
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}

  - name: headache_level
    ctype: examination
    transformations:
      - dtype_correction: {dtype: Float64}

  - name: muscle_pain
    transformations:
      - dtype_correction: {dtype: boolean}

  - name: muscle_pain_level
    transformations:
      - dtype_correction: {dtype: Float64}

  - name: movement
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}

  - name: restlessness
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}
    warning: Are restlessness and lethargy the same?

  - name: agitated
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}

  - name: perfusion
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}

  - name: lethargy
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}

  - name: conjunctival_injection
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}

  - name: hepatomegaly
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}

  - name: joint_pain
    ctype: examination

  - name: joint_pain_level
    ctype: examination

  - name: dehydration
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}
    description: In physiology, dehydration is a deficit of total body water, with
                 an accompanying disruption of metabolic processes. It is the same
                 as dehydratation, wrong use in the medical language.

  # ------------------
  # Neurology (CNS)
  # ------------------
  - name: gcs
    ctype: examination
    description: The Glasgow Coma Scale (GCS) is a clinical scale used to reliably measure a person's
                 level of consciusness after a brain injury. The GCS assess a person based on their
                 ability to perform eye movements (eye), speak (verbal) and move their body (motor).

  - name: gcs_verbal_response
    ctype: examination
    description: The Glasgow Comma Score for verbal response.
    transformations:
      - dtype_correction: {dtype: Int64}

  - name: gcs_motor_response
    ctype: examination
    description: The overall Glasgow Comma Score for motor response.
    transformations:
      - dtype_correction: {dtype: Int64}

  - name: gcs_eye_movement
    ctype: examination
    description: The overall Glasgow Comma Score for eye response.
    transformations:
      - dtype_correction: {dtype: Int64}

  - name: cns_abnormal_signs
    ctype: examination
    warning: Could it be merged with cns_abnormal?
    transformations:
      - dtype_correction: {dtype: boolean}

  - name: cns_abnormal
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}


  # ------------------
  # Examination - Liver
  # ------------------
  - name: liver_acute
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}


  # ------------------
  # Fluids
  # ------------------
  - name: crystalloid
    ctype: examination

  - name: parental_fluid
    ctype: examination
    transformations:
      - dtype_correction: {dtype: boolean}
      - static_correction: {method: max, groupby: patient}

  # ------------------
  # Laboratory Results
  # ------------------
  # Reference: http://www.scymed.com/en/smnxtb/smnxtb.htm
  - name: albumin
    unit: g/L                  # U/L=g/dL | SI=g/L | F=10
    ctype: laboratory
    range:
      absolute: [0, 100, g/L]
      ref1: [35, 55, g/L]      # wiki | scymed
      ref2: [3.5, 4.8, g/dL]   # wiki
    transformations:
      - dtype_correction: {dtype: Float64}
      - range_correction:
          range: [0, 1000000000000] #[0, 100]

  - name: alt
    unit: U/L                   # U/L=U/L | SI=ukat/L | F=0.01667
    ctype: laboratory
    range:
      absolute: [0, 9999, U/L]  # oucru
      ref1: [5, 20, U/L]        # wiki
      ref2: [7, 21, U/L]        # wiki
      ref3: [8, 56, U/L]        # wiki
      ref4: [10, 40, U/L]       # scymed
    transformations:
      - dtype_correction: {dtype: Float64}
      - range_correction:
          range: [0, 1000000000000] # [0, 9999]

  - name: ast
    unit: U/L                   # U/L=U/L | SI=ukat/L | F=0.01667
    ctype: laboratory
    range:
      absolute: [0, 9999, U/L]  # oucru
      ref_female: [6, 34, U/L]  # wiki  ref = ('gender', 'Female', [X, X, X])
      ref_male: [8, 40, U/L]    # wiki
      ref1: [10, 40, U/L]       # scymed
    transformations:
      - dtype_correction: {dtype: Float64}
      - range_correction:
          range: [0, 1000000000000] # [0, 9999]

  - name: creatine_kinase
    unit: U/L                    # U/L=U/L | SI=ukat/L | F=0.01667
    ctype: laboratory
    range:
      absolute: [0, 9999, U/L]   # oucru
      ref_male: [24, 174, U/L]   # wiki (U/L = ng/mL)
      ref_female: [24, 200, U/L] # wiki (U/L = ng/mL)
      ref1: [10, 90, U/L]        # scymed
    transformations:
      - dtype_correction: {dtype: Float64}
      - range_correction:
          range: [0, 1000000000000] # [0, 9999]

  - name: haemoglobin
    code: hgb                # U/L=g/dL | SI=g/L | C=10
    unit: g/dL
    ctype: laboratory
    range:
      absolute: [1, 30, g/dL]
      ref1_male: [130, 162, g/L]
      ref2_female: [120, 150, g/L]
      ref3: [12, 18, g/dL]
    transformations:
      - dtype_correction: {dtype: Float64}
      - range_correction:
          range: [0, 1000000000000] # [0.1, 50]

  - name: lymphocytes
    unit: u/L
    ctype: laboratory
    range:
      ref_adult: [0.7, 3.5, gigacount/L] # 10^9/L wiki
      ref_newborn: [2, 11, gigacount/L]  # 10^9/L wiki
    transformations:
      - dtype_correction: {dtype: Float64}

  - name: monocytes
    unit: u/L
    ctype: laboratory
    range:
      ref_adult: [0.1, 0.8, gigacount/L]   # 10^9/L wiki
      ref_newborn: [0.4, 3.1, gigacount/L] # 10^9/L wiki
    transformations:
      - dtype_correction: {dtype: Float64}

  - name: neutrophils
    unit: u/L
    ctype: laboratory
    range:
      ref1: [2500, 8000, count/mm3]
    transformations:
      - dtype_correction: {dtype: Float64, errors: coerce}

  - name: haematocrit_percent
    unit: percent
    ctype: laboratory
    transformations:
      - dtype_correction: {dtype: Float64, errors: coerce}
      - range_correction:
          range: [0, 100]

  - name: lymphocytes_percent
    unit: percent
    ctype: laboratory
    range:
      ref1: [16, 33, percent] # percent of WBC wiki
    transformations:
      - dtype_correction: {dtype: Float64, errors: coerce}
      - range_correction:
          range: [0, 100]

  - name: monocytes_percent
    unit: percent
    ctype: laboratory
    range:
      ref1: [3, 7, percent] # percent of WBC wiki
    transformations:
      - dtype_correction: {dtype: Float64, errors: coerce}
      - range_correction:
          range: [0, 100]

  - name: neutrophils_percent
    unit: percent
    ctype: laboratory
    transformations:
      - dtype_correction: {dtype: Float64, errors: coerce}
      - range_correction:
          range: [0, 100]

  - name: plt
    unit: kilocount/uL
    ctype: laboratory
    range:
      absolute: [1, 1600, kilocount/uL]  #They are the same!
      reference: [140, 350, gigacount/L]
    transformations:
      - dtype_correction: {dtype: Float64}
      - range_correction:
          range: [0, 1000000000000] # [ , ]

  - name: wbc
    unit: kilocount/uL
    ctype: laboratory
    range:
      absolute: [0.1, 50, kilocount/uL]
      reference_adult: [3.5, 9.0, gigacount/L] # 0^9/L wiki
    transformations:
      - dtype_correction: {dtype: Float64, errors: coerce}
      - range_correction:
          range: [0, 1000000000000] # [0.1, 50]

  - name: sodium
    unit: U/L       # U/L=mEq/L | SI=mmol/L | C=1
    ctype: laboratory
    range:
      ref1: [136, 145, mEq/L]
    transformations:
      - dtype_correction: {dtype: Float64}

  - name: creatinine
    unit: mmol/L   # U/L=mg/dL | SI=mmol/L | C=88.42 # check BlenderTemplate!
    ctype: laboratory
    range:
      ref1: [0.5, 1.5, mg/dL]
      ref2: [50, 150, mmol/L]
    transformations:
      - dtype_correction: {dtype: Float64}

  - name: rbc
    ctype: laboratory
    warning: What does it mean a Red Blood Cells value True?

  - name: ffp
    ctype: laboratory

  - name: glucose
    unit: mmol/L
    ctype: laboratory
    range:
      ref1: [0.0, 7.8, mmol/L]
    transformations:
      - dtype_correction: {dtype: Float64}

  - name: urea   # blood urea
    unit: mg/dL
    ctype: laboratory
    range:
      ref1: [7, 20, mg/dL]
      ref2: [2.5, 7.1, mmol/L]
    transformations:
      - range_correction:
          range: [0, 1000000000000] # [0.5, 15]

  - name: crp
    unit: mg/L
    ctype: laboratory
    range:
      ref1: [0, 10, mg/L]   # Normal
      ref2: [10, 40, mg/L]  # pregnant, mild inflammation, viral infection
      ref3: [40, 200, mg/L] # bacterial infection

  - name: procalcitonin
    unit: ng/mL
    ctype: laboratory
    range:
      ref1: [0, 0.15, ng/mL] # normal

  - name: potassium
    ctype: laboratory
    range:
      ref1: [3.6, 5.2, mmol/L] # normal

  - name: bilirubin_direct
    ctype: laboratory
    range:
      ref1: [0, 0.3, mg/dL]
      ref2: [0, 5.1, umol/L]

  - name: bilirubin_total
    ctype: laboratory
    range:
      ref1: [0, 1.2, mg/dL]
      ref2: [1.71, 20.5, umol/L]

  - name: ddimer
    ctype: laboratory
    description: It is a numeric but has ',' and ',1.0'. In addition a D-Dimer value of 0.5
                 or greater is considered positive. Why does the dataset has values from 0 to
                 5?

  - name: fibrinogen
    warning: 1. Had a ',' value | Solved.
    transformations:
      - dtype_correction: {dtype: Float64, errors: coerce}

  - name: aptt
    ctype: laboratory
    warning: Has ',' values | Corrected.
    transformations:
      - dtype_correction: {dtype: Float64, errors: coerce}

  # ---
  # PCR
  # ---
  - name: pcr_dengue_reaction
    ctype: PCR
    warning: What are the units of a PCR reaction?
    transformations:
      - dtype_correction: {dtype: Float64, errors: coerce}

  - name: pcr_dengue_load
    unit: copies/mL
    ctype: PCR
    transformations:
      - dtype_correction: {dtype: Float64, errors: coerce}

  - name: pcr_dengue_serotype
    ctype: PCR
    categories:
      - <LOD
      - DENV-1
      - DENV-2
      - DENV-3
      - DENV-4
      - Mixed
    transformations:
      - replace_correction:
          to_replace: {
            'Not done': null,
            'Unknown': null
          }
      - static_correction: {method: mode, groupby: patient}

  - name: pcr_dengue_interpretation                          # REVIEW
    ctype: PCR
    categories:
      - Not Dengue
      - Lab-confirmed Dengue
      - Presumptive Dengue
      - Acute Flavivirus
      - Recent Flavivirus
      - Inconclusive
      - Other Inconclusive
    transformations:
      - static_correction: {method: mode, groupby: patient}

  # -----------
  # Serology
  # -----------
  - name: igm
    unit: g/L
    ctype: serology
    transformations:
      - dtype_correction: {dtype: Float64, errors: coerce}
    description: Found mainly in blood and lymph fluid, this is the first antibody
                 the body makes when it fights a new infection.

  - name: igg
    unit: g/L
    ctype: serology
    transformations:
      - dtype_correction: {dtype: Float64, errors: coerce}
    description: This is the most common antibody. It's in blood and other body fluids,
                 and protects against bacterial and viral infections. IgG can take time
                 to form after an infection or immunization.

  - name: igm_interpretation
    ctype: serology
    categories:
      - Positive
      - Negative
      - Equivocal

  - name: igg_interpretation
    ctype: serology
    categories:
      - Positive
      - Negative
      - Equivocal

  - name: serology_interpretation
    ctype: serology
    categories:
      - Primary
      - Secondary
      - Inconclusive

  # --------
  # NS1
  # --------
  - name: ns1_concentration
    ctype: NS1
    transformations:
      - dtype_correction: {dtype: Float64}

  - name: ns1_interpretation
    ctype: NS1
    categories:
      - Positive
      - Negative
      - Equivocal
    transformations:
      - replace_correction:
            to_replace: { No sample: null }

  - name: ns1_plasma_concentration
    ctype: NS1
    transformations:
      - dtype_correction: {dtype: Float64, errors: coerce}

  - name: ns1_plasma_optical_density
    ctype: NS1
    transformations:
      - dtype_correction: {dtype: Float64, errors: coerce}

  - name: ns1_plasma_interpretation
    ctype: NS1
    categories:
      - Positive
      - Negative
      - Equivocal
    transformations:
      - replace_correction:
          to_replace: {
            Missing: null,
            'Equivocal?': Equivocal,
            Neg: Negative,
            Pos: Positive,
            neg: Negative,
            pos: Positive
          }
    warning: What about 'Equivocal,neg'? If we want to keep both then it needs to be
             corrected through the DataBlend configuration files. Otherwise, it can
             just be set to positive in the replace_correction.

  - name: ns1_urine_concentration
    ctype: NS1
    transformations:
      - dtype_correction: {dtype: Float64, errors: coerce}

  - name: ns1_urine_interpretation
    ctype: NS1
    categories:
      - Positive
      - Negative
      - Equivocal
    transformations:
      - replace_correction:
          to_replace: {
            Neg: Negative,
            Pos: Positive,
            pos: Positive,
            neg: Negative,
            Missing: null}

  - name: ns1_urine_optical_density
    ctype: NS1
    transformations:
      - dtype_correction: {dtype: Float64, errors: coerce}

  - name: ns1_trip_control_interpretation
    ctype: NS1

  - name: ns1_trip_test_interpretation
    ctype: NS1
    warning: As it is an interpretation, should it be Positive, Negative or Equivocal?

  - name: ns1_platelia_interpretation
    ctype: NS1

  # --------
  # Outcomes
  # --------
  - name: dengue_serology_interpretation   # REVIEW
    warning: What to do with this?

  - name: dengue_pcr_interpretation        # REVIEW
    warning: What to do with this?

  - name: dengue_interpretation
    transformations:
      - dtype_correction: {dtype: boolean}

  - name: shock
    ctype: outcome
    description: Whether the patient suffered at least one shock during the stay
    transformations:
      - dtype_correction: {dtype: boolean}
      - static_correction: {method: max, groupby: patient}
      - fillna_correction: {value: False}

  - name: shock_multiple
    ctype: outcome
    description: Whether the patient suffered multiple shocks during the stay
    transformations:
      - dtype_correction: {dtype: boolean}
      - static_correction: {method: max, groupby: patient}
      - fillna_correction: {value: False}

  - name: outcome
    ctype: outcome
    categories:
      - Full recovery
      - Self discharge
      - Transferred
      - Died
      - Unknown
    transformations:
      - static_correction: {method: mode, groupby: patient}
    warning: Review, might be inportant later.

  - name: icd_code
    ctype: outcome
    transformations:
      - fillna_correction: {method: ffill, groupby: patient} # (review to fbfill)

  # --------
  # Events
  # --------
  - name: event_onset
    ctype: event
    description: Date of disease onset (first fever if not found)
    transformations:
      - dtype_correction: {dtype: boolean}
      - unique_true_value_correction: {keep: first, groupby: patient}

  - name: event_admission
    ctype: event
    transformations:
      - dtype_correction: {dtype: boolean}
      - unique_true_value_correction: {keep: first, groupby: patient}

  - name: event_enrolment
    ctype: event
    transformations:
      - dtype_correction: {dtype: boolean}
      - unique_true_value_correction: {keep: first, groupby: patient}

  - name: event_discharge
    ctype: event
    transformations:
      - dtype_correction: {dtype: boolean}
      - unique_true_value_correction: {keep: first, groupby: patient}

  - name: event_death
    ctype: event
    transformations:
      - dtype_correction: {dtype: boolean}
      - unique_true_value_correction: {keep: first, groupby: patient}

  - name: event_shock
    ctype: event
    transformations:
      - dtype_correction: {dtype: boolean}

  - name: event_followup
    ctype: event
    transformations:
      - dtype_correction: {dtype: boolean}

  - name: event_infusion
    ctype: event
    transformations:
      - dtype_correction: {dtype: boolean}

  - name: event_laboratory
    ctype: event
    transformations:
      - dtype_correction: {dtype: boolean}

  - name: event_ns1
    ctype: event
    transformations:
      - dtype_correction: {dtype: boolean}

  - name: event_pcr
    ctype: event
    transformations:
      - dtype_correction: {dtype: boolean}

  - name: event_sorology
    ctype: event
    transformations:
      - dtype_correction: {dtype: boolean}

  - name: event_ultrasound
    ctype: event
    transformations:
      - dtype_correction: {dtype: boolean}

  - name: event_cytokine
    ctype: event
    transformations:
      - dtype_correction: {dtype: boolean}


  # ---------
  # To review
  # ---------
  - name: effusion
    ctype: examination

  - name: heart_sound_abnormal
  - name: igg_indirect_interpretation
    warning: What is this? Is it paired_igm_igg serology? why does it mention only igg?

  - name: meningism
    warning: Is this meningitis?

  - name: myocardial_infarction

  - name: nausea
    warning: Can this be merged with sometiong? appetite_lost?

  - name: neurology
    warning: Can it be merged with neurology_abnormal?
             Can it be merged with cns_abnormal?
             Can it be merged with cns_abnormal_signs?
             Can it be merged with cerebro?

  - name: rehydration
    warning: Is this dehydration? Seen in 32dx and 43dx.

  - name: restlesness
    warning: fix! restlessness

  # --------------------
  # Computed features
  # --------------------
  - name: serology_paired
    description: Computed from method ... 'method'.


  # --------------------
  # Unknon features
  # --------------------
  - name: hemi
    warning: What does this feature represent?

  - name: rest_paint
    warning: What does this feature represent? Can this be pain? If so what pain?
             Can it be merged with painful?

  - name: restro_pain
    warning: What does this feature represent?

  - name: slivel
    warning: What does this feature represent?
             Can it be merged with other feature?

  - name: blood_fluid
    warning: Review and implement!

  - name: cerebro
    warning: What does this feature represent?
             Can it be merged with cns_abnormal?
             Can it be merged with neurology_abnormal?

  - name: chrocomp
    warning: What does this feature represent?
             Which are the chronic complications?
             Remember other chronic_hepatitis or chronic_pulmo...?

  - name: localsign
    warning: What kind of local sign? See below.

  - name: liver_size
    warning: Rename to liver_palpation_size.

  - name: msolidtur
    warning: What does this feature represent?

  - name: reshock
    warning: What does this feature represent?

  - name: srdeficien
    warning: What does this feature represent?

  - name: ultrasound
    warning: Review! Only in one study though...

  - name: dos
    warning: Day of sample. Ignore, to be removed.

  - name: contissue
    warning: Any significant past medical connective issue.
             Can it be merged with any other feature?

  - name: crt
    warning: Cardiac Resyncrhonization Therapy

  - name: able_to_drink
    warning: What to do with this variable?

  - name: appetite_list
    warning: What to do with this variable?

  - name: area_type@
    warning: Merge with ....?

  - name: behaviour
    warning: What to do with this variable? It should be boolean (all 1).

  - name: bleeding_mucosal_description
    warning: Rename as bleeding_description.

  - name: bleeding_mucosal_specification
    warning: Rename as bleeding_description.

  - name: bleeding_site
    warning: Rename as bleeding_description.

  - name: bleeding_weird
    warning: Rename as bleeding_description.

  - name: blood_pressure_down
    warning: Is this dyastolic blood pressure?

  - name: blood_pressure_up
    warning: Is this systolic blood pressure?

  - name: care_type
    warning: Merge with other features.
             admitted_hospital rename (1 as 'Hospital')
             what are level 1, level 2 and level 3?

  - name: cns_abnormal_description
    warning: Merge with cnsother

  - name: day
    warning: Remove from DataBlend

  - name: ddi_test
    warning: Is numeric but has '<0.5' and '>=0.8'

  - name: admission_from_hospital_date
    warning: Remove from DataBlend!

  - name: final_diag
    warning: diagnosis_final

  - name: diagnosis
    warning: diagnosis_final

  - name: diagnosic_admission
    warning: diagnosis_admission

  - name: discharge_status
    warning: what is the meaning of this encoding?

  - name: extremities
    warning: What does this feature and its encoding represents?

  - name: fever
    warning: Think overlapping with event_fever and body_temperature

  - name: from_adm
    warning: It is the day from admission, remove from DataBlend

  - name: heart_sound_abnormal_desc
    warning: Could it be merged with heart_sound_description?

  - name: heart_sound_description
    warning: It has V_1 value!

  - name: historical
    warning: What does this feature represent?

  - name: historical_desc
    warning: It has V_1, ..., V_3 values!

  - name: hospital_admitted
    warning: What does this value represent?
             Maybe hospital names encoded?

  - name: hs_concentration
    warning: What does this value represent?

  - name: immune status
    warning: Merge with below (if content matches)

  - name: immune_status
    warning: Is this related with serology_interpretation? Primary/secondary/Inconclusive?

  - name: indirect_elisa
    warning: Is this ns1? Is this the igm_igg_single? igm_igg_paired?
             What does the float value represent?
    transformations:
      - dtype_correction: {dtype: Float64, errors: coerce}

  - name: indirect_elisa_result
    warning: Is this ns1? Is this the igm_igg_single? igm_igg_paired?
             What does theint value represent? Are these the Positive, Negative or Equivocal codes?

  - name: lung
    warning: Related with lung_details.

  - name: lung_details
    warning: It is in vietnamese

  - name: lymphadenopathy_specification
    warning: What is the encode for 1?

  - name: malignancy
    warning: What does this feature represent?

  - name: meche
    warning: What does this feature represent?

  - name: no_symptoms
    warning: Ignore?

  - name: occupation
    warning: Merge with... job.

  - name: oxygen
    warning: Review if it can be merged with oxygen_mask?

  - name: painful
    warning: what is painful? adbominal pain? join pain?

  - name: place
    warning: It still has 'V_0', ..., 'V_4' values!

  - name: pleural_effusion_side
    warning: Don't know if it refers to left/right. If so,
             what is the encoding? If not, what other things
             might 2 and 3 be enconding?

  - name: reason
    warning: reason for what?

  - name: respiratory_desc
    warning: It still has V_1 and V_2 values!

  - name: retro_pain
    warning: What pain is this?

  - name: skidney
    warning: What does this feature represent?

  - name: skin_describe
    warning: merge with skin_description

  - name: skin_reash_description
    warning: fix name

  - name: ventilation
    warning: Be careful with ventilation (True and Fals)
             and ventilation_type (canula, ncpap, ...)

  - name: ward
    warning: Merge with ward_admitted below?

  - name: city
    ctype: Patient
    transformations:
      - string_correction: {}

  - name: other
    warning: Unclear what this is. It has also V_1 need to review.

  - name: outpatient
    warning: It has only False

  - name: passing_urine
    warning: Can it be associated/merged with any other feature?

  - name: pharyngeal
    warning: Does it refer also to pharyngeal injection?

  - name: platelet_no
    warning: what is this representing? Is not a platelet value.

  - name: previous_dengue
    waarning: Can this be renamed to immune_status?

  - name: severity_status
    warning: There was some severity variable already defined.